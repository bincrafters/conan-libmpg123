diff --git a/ports/cmake/src/libmpg123/CMakeLists.txt b/ports/cmake/src/libmpg123/CMakeLists.txt
index ad69b7a..6e0a80f 100644
--- a/ports/cmake/src/libmpg123/CMakeLists.txt
+++ b/ports/cmake/src/libmpg123/CMakeLists.txt
diff --git a/ports/cmake/src/libmpg123/CMakeLists.txt b/ports/cmake/src/libmpg123/CMakeLists.txt
index ad69b7a..f287c4e 100644
--- a/ports/cmake/src/libmpg123/CMakeLists.txt
+++ b/ports/cmake/src/libmpg123/CMakeLists.txt
@@ -123,11 +123,14 @@ if(MSVC)
     if(NOT YASM_ASSEMBLER)
         message(FATAL_ERROR "Couldn't find yasm assembler. Please set YASM_ASSEMBLER variable")
     endif()
-    if((MSVC AND CMAKE_GENERATOR_PLATFORM STREQUAL "x64") OR (NOT MSVC AND CMAKE_SYSTEM_PROCESSOR MATCHES "([xX]86_|AMD|amd)64"))
+    if((MSVC AND CMAKE_GENERATOR_PLATFORM STREQUAL "x64") OR OR (MSVC AND CMAKE_VS_PLATFORM_NAME STREQUAL "x64") (NOT MSVC AND CMAKE_SYSTEM_PROCESSOR MATCHES "([xX]86_|AMD|amd)64"))
         set(MACHINE amd64)
-    elseif((MSVC AND CMAKE_GENERATOR_PLATFORM MATCHES "|Win32") OR (NOT MSVC AND CMAKE_SYSTEM_PROCESSOR MATCHES "i386"))
+    elseif((MSVC AND CMAKE_GENERATOR_PLATFORM MATCHES "|Win32") OR (MSVC AND CMAKE_VS_PLATFORM_NAME STREQUAL "Win32") OR (NOT MSVC AND CMAKE_SYSTEM_PROCESSOR MATCHES "i386"))
         set(MACHINE x86)
     endif()
+    message(${CMAKE_VS_PLATFORM_NAME})
+    message(${CMAKE_GENERATOR_PLATFORM})
+    message(${MACHINE})
     list(TRANSFORM PLATFORM_DEFINITIONS PREPEND /D)
     foreach(FILE ${PLATFORM_SOURCES})
         get_filename_component(FILENAME ${FILE} NAME)
